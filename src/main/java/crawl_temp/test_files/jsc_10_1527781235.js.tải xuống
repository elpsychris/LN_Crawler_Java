var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,b,e){var d=this.length||0;0>b&&(b=Math.max(0,d+b));if(null==e||e>d)e=d;e=Number(e);0>e&&(e=Math.max(0,d+e));for(b=Number(b||0);b<e;b++)this[b]=a;return this}},"es6","es3");
var cbx={ver:1046,lp:0},lang=[],config={};if(document.currentScript){var matches=document.currentScript.src.match(/_(.*)\.js/);matches&&1<matches.length&&(cbx.build=matches[1])}cbx.isTopLevel=window===window.parent;
var overlay=function(){var a,c,b,e,d,f=null,g=!1,h=null,k=function(l){var n=document.body.onmousedown;a||(a=document.getElementById("overlay"),c=document.getElementById("overlayStage"),b=document.getElementById("barTitle"),e=document.getElementById("barDefault"),d=document.getElementById("barNotice"));h||(h=makeButton("ChevLeft","","",function(){k()},"btnTitle").enable());f&&(c.appendChild(f.body),f.isVisible=!1,f=null,document.body.onmousedown=n);a.innerHTML="";l?(document.body.onmousedown=function(d){d=
d.target;do if(d===a)return;while(d=d.parentElement);k()},e.className="bar Hide",d.className="bar Hide",b.className="bar",h.text(l.title),a.appendChild(l.body),l.isVisible=!0,f=l,classToggle(document.body,"WithOverlay",!0),classToggle(document.body,"Full",g)):(classToggle(document.body,"WithOverlay",!1),classToggle(document.body,"Full",!1),b.className="bar Hide",e.className="bar",d.className="bar Hide");cbx.autoScroll(!1)};return{create:function(a,d){var b=document.createElement("div");b.className=
"ovr"+d;return{body:b,isVisible:!1,title:a?a:""}},switchTo:k,getCurrent:function(){return f},setFull:function(a){f&&a!==g&&(g=a,classToggle(document.body,"WithOverlay",!0),classToggle(document.body,"Full",g))}}}(),classToggle=function(a,c,b){var e=null,d=a.className?a.className.split(" "):[],f=d.indexOf(c),g="undefined"===typeof b;-1===f||!1!==b&&!g||(d.splice(f,1),e=!1);-1!==f||!0!==b&&!g||(d.push(c),e=!0);a.className=d.join(" ");return e},classState=function(a,c){return-1!==(a.className?a.className.split(" "):
[]).indexOf(c)?!0:!1},windowIsFocused=!0,init=function(a,c){config=a;lang=c;Blank.init(config.id+"_"+config.tid);cbx.debug.log("Starting");cbx.notifyParent("loading");var b=document.forms.cbox;window.f=cbx.$frm=b;config.sno=8<window.name.length?window.name.substring(8):config.sno;cbx.refreshBtn=makeButton("Circle","","",function(){return!1},"btnRefresh");config.uon&&window.setTimeout(initOnliners,600);var e=overlay.create("Smilies","Smilies"),d=null;makeButton("Smile","","Smilies",function(a,c){var f=
function(a,d){Emotes.enqueueAll(a);var c=a.getElementsByClassName("emoteBtn");for(a=0;a<c.length;a++)(function(a){var f=c[a].getAttribute("data-code");d&&Tooltip(c[a],f,c[a]);c[a].onclick=function(){insertAtCaret(f);window.setTimeout(function(){b.pst.focus()},100)}})(a)};if(d&&!d.closed)d.focus();else if(c.shiftKey){var g=pop(location.href+"&sec=smilies",300,600,!1,function(){f(g.document)});d=g}else overlay.switchTo(e.isVisible?null:e),e.loaded||cbx.xhr("smilies",{xhr:1},null,function(a,d){e.body.innerHTML=
a;e.loaded=!0;f(document,!0)})},"btnSmilies").enable();cbx.isTopLevel?b.pst.focus():makeButton("Pop","","Pop out",function(a){var d=pop(window.location.href,600,600,1);a.onclick(function(){d&&!d.closed?d.focus():d=pop(window.location.href,600,600,1)})},"btnPop").enable();var f=makeButton("Go","","Post",function(){b.onsubmit()},"btnSubmit").disable();b.onsubmit=function(){return do_post()};if("TEXTAREA"==b.pst.tagName.toUpperCase()){var g=function(){b.pst.scrollHeight>b.pst.offsetHeight&&b.pst.clientHeight<
.5*document.body.clientHeight&&(b.pst.style.height=b.pst.scrollHeight+"px",cbx.autoScroll(!1));""==b.pst.value?(b.pst.style.height="auto",f.disable()):f.enable()};b.pst.onkeypress=function(a){g();var d=window.event&&window.event.keyCode||a.keyCode||a.which;if((13==d||10==d)&&a.ctrlKey)return insertAtCaret("\n",!0),!0;if(13!=d)return!0;do_post()&&b.submit();return!1};b.pst.onfocus=function(a){document.getElementById("caret")&&(document.getElementById("caret").className="Hide");g()};b.pst.onchange=
g;b.pst.onkeyup=b.pst.oninput=function(a){b.pst.value.length>config.ml&&(b.pst.value=b.pst.value.substring(0,config.ml));g()}}cbx.gsUser=cbx.getGSObject(config.id+":user");cbx.gsPrefs=cbx.getGSObject("_:prefs");b.key.value&&b.nme.value?(cbx.gsUser.set("key",b.key.value),cbx.gsUser.set("nme",b.nme.value),cbx.gsUser.set("eml",b.eml.value),cbx.gsUser.set("pic",b.pic.value)):(b.key.value=cbx.gsUser.get("key")||"",b.nme.value=cbx.gsUser.get("nme")||"",b.eml&&(b.eml.value=cbx.gsUser.get("eml")||""),b.pic&&
(b.pic.value=cbx.gsUser.get("pic")||""));window.onbeforeunload=function(){};window.onfocus=function(){cbx.notifyParent("focus");windowIsFocused=!0;cbx.isTopLevel&&updateFavicon(0)};window.onblur=function(){cbx.notifyParent("blur");windowIsFocused=!1;cbx.isTopLevel&&messages.setBookmark()};window.onkeydown=function(a){};var h=window;cbx.lp=Math.max(cbx.lp,1*config.lpid);h.nme&&b.nme.value==lang[1]&&(b.nme.value=h.nme);h.eml&&b.eml&&b.eml.value==lang[5]&&(b.eml.value=h.eml);h.onunload=function(){h=
cbx.$body=null};window.setTimeout(function(){initAudio(config.snuri)},1200);profileBtnSetup();authBtnSetup();cbx.modBtn=makeButton("Approval","","Pending messages",function(){config.uo?pop(config.mc_uo_path,320,480,0):pop("./?"+config.rq+"&sec=modchan&n="+esc(cbx.$frm.nme.value)+"&k="+esc(cbx.$frm.key.value),320,480,0)},"btnModPop").hide();cbx.upd_tms();msgToolsUpdate();config.xp||(cbx.arMgr.onconnect=function(){cbx.presMgr.sendPing(null);cbx.xhr("ar",{p:cbx.lp,c:cbx.unixTime()},null,function(a,d){a&&
!d&&cbx.aj_proc(a)})},cbx.arMgr.run());!config.uon&&!config.pm||cbx.presMgr.state||cbx.presMgr.run();config.uon&&userViewMon.init(function(){});config.uon&2&&cbx.addTypingHandler(b.pst,function(a){cbx.presMgr.sendPing(a?"typing":"idle")});cbx.autoScroll(!0);cbx.listenParent()};"undefined"===typeof window.JSON&&(window.JSON={parse:function(){},stringify:function(){}});
cbx.getGSObject=function(a,c){var b;try{var e=window.localStorage,d=e.getItem("cbx:"+a);if(d&&(b=JSON.parse(d))&&b.val)var f=b.val}catch(g){cbx.debug.log("[GS] get failed: "+g.name)}b||(b={});f||(f={});return{get:function(a){return f[a]},set:function(d,h){if(!f[d]||f[d]!==h||"object"===typeof h){f[d]=h;b.val=f;d=(new Date).getTime()/1E3|0;b.ctime?b.mtime=d:b.ctime=d;c&&(b.ttl=1*c);try{e.setItem("cbx:"+a,JSON.stringify(b))}catch(k){cbx.debug.log("[GS] set failed: "+k.name)}}},toString:function(){return JSON.stringify(f)}}};
cbx.notifyParent=function(a,c){window.postMessage&&(cbx.isTopLevel||window.parent.postMessage(JSON.stringify({event:""+a,data:c,serial:config.sno}),"*"))};
cbx.listenParent=function(){window.onmessage=function(a){if(!a||!a.origin||null===a.origin.match(/\.cbox\.ws$/)&&null===a.origin.match(/cbox\.im$/))cbx.debug.log("Got wrong origin "+a.origin,"PARENT");else{var c={};try{c=JSON.parse(a.data)}catch(e){cbx.debug.log("Got bad JSON","PARENT")}a=c._call;var b=c.args;cbx.debug.log("Got call "+a,"PARENT");"ruready"===a&&cbx.notifyParent("ready");if("elemFromPoint"===a){b=document.elementFromPoint(b.x,b.y);if(null===b){cbx.notifyParent(a,null);return}cbx.notifyParent(a,
b.tagName+" "+b.className)}"setStyle"===a&&(cbx.setStyle(c.sel,c.prop,c.val),cbx.debug.log("GOT SETSTYLE FOR "+c.prop,"PARENT"));"loadCSS"===a&&(cbx.loadCSS(window,"./?"+config.rq+"&sec=css&i="+c.which),cbx.debug.log("GOT loadCSS FOR "+c.which,"PARENT"));"replaceCSS"===a&&(cbx.replaceCSS(c.cssText),cbx.debug.log("GOT replaceCSS","PAR"));"type"===a&&(a=cbx.$frm,a.pst.value=a.pst.value+" "+c.message,a.pst.focus())}};cbx.notifyParent("ready")};
cbx.debug={loadTime:(new Date).getTime(),history:[],log:function(a,c){var b=cbx.debug;b.history.push({time:(((new Date).getTime()-cbx.debug.loadTime)/1E3).toFixed(3),msg:a,group:c?c:""});50<b.history.length&&b.history.shift()},stringify:function(a){if("string"===typeof a||"number"===typeof a)return a;var c=[],b;for(b in a)c.push(b+": "+a[b]);return c.join(", ")}};
cbx.debugOverlay=function(){var a=null,c=overlay.create("Debug log","Debug"),b=function(){overlay.switchTo();a&&window.clearInterval(a);a=null},e=function(){overlay.switchTo(c)},d=function(){for(var a=["<b>Version:</b>  "+cbx.ver+" build "+cbx.build+" in "+document.compatMode+"<br>","<b>Namespace:</b>  "+config.srv+"-"+config.id+"-"+config.tid+" ("+config.sno+") "+("https:"==document.location.protocol?"HTTPS":"")+"<br>","<b>User Agent:</b> "+navigator.userAgent+"<br>","<b>V state:</b> "+userViewMon.state+
" ("+JSON.stringify(userViewMon.props)+")<br>","<b>FP:</b> "+cbx.fp+"<br>","<b>Time:</b> "+(new Date).getTime()+", since load: "+(((new Date).getTime()-cbx.debug.loadTime)/1E3).toFixed(3)+", srv adj: "+cbx.unixTime()+"<br>","<b>Prefs:</b> "+cbx.gsPrefs.toString()+"<br>","<b>User:</b> "+cbx.gsUser.toString()+"<br>","<b>Last message ID:</b> "+cbx.lp+"<br>","<b>Scroll lock:</b> "+scrollFollow+"<br>","<b>ARMGR state:</b> "+cbx.arMgr.state+", adapter: "+cbx.arMgr.adapter+" conn ID: "+cbx.arMgr.upstream+
", wait: "+cbx.arMgr.backoff+"<br>","<b>WS/FL/LP/RP state:</b> "+wsconn.state+" / "+flconn.state+" / "+cbx.lpconn.state+" / "+cbx.repl.state+"<br>","<b>Repl:</b> client "+cbx.repl.clientID+"; "+(null===cbx.repl.masterID?"MASTER":"slave of "+cbx.repl.masterID)+"<br>","<b>Presence:</b> "+cbx.presMgr.state+"<br>","<b>--- Log ---</b><br>"],d=0;d<cbx.debug.history.length;d++){var b=cbx.debug.history[d];a.push(b.time+" ["+b.group+"] "+b.msg+"<br>")}c.body.innerHTML=a.join("")};return{update:d,show:e,hide:b,
toggle:function(){c&&c.isVisible?b():(d(),e())},autorefresh:function(){b();a=window.setInterval(d,500);d();e()},getHTML:function(){d();return c.body.innerHTML}}}();cbx.cmdHistory=[];cbx.cmdCursor=0;
cbx.cmdExec=function(a){if("//"!==a.substring(0,2))return!1;var c=cbx.$frm;c.pst.onkeydown=function(a){a=a||window.event;"INPUT"!==c.pst.tagName||!cbx.cmdHistory.length||38!=a.keyCode&&40!=a.keyCode||(38==a.keyCode&&cbx.cmdCursor+1<cbx.cmdHistory.length&&(cbx.cmdHistory[cbx.cmdCursor]=c.pst.value,c.pst.value=cbx.cmdHistory[++cbx.cmdCursor]),40==a.keyCode&&cbx.cmdHistory.length&&cbx.cmdCursor&&(cbx.cmdHistory[cbx.cmdCursor]=c.pst.value,c.pst.value=cbx.cmdHistory[--cbx.cmdCursor]),a.preventDefault&&
a.preventDefault())};a!==cbx.cmdHistory[0]&&(cbx.cmdHistory[0]=a,cbx.cmdHistory.unshift(""),10<cbx.cmdHistory.length&&cbx.cmdHistory.pop());cbx.cmdCursor=0;var b={error:function(){window.setTimeout(function(){throw Error("Debug error");},1)},debug:function(a,b){"send"==a?b?(a=cbx.debugOverlay.getHTML(),statusBar.set("Sending"),cbx.xhr("senddebug",null,{tag:b,html:a},function(a,d){d?statusBar.warn(d):statusBar.set("Sent")})):statusBar.warn("Please provide tag"):"watch"==a?cbx.debugOverlay.autorefresh():
cbx.debugOverlay.toggle()},reload:function(a){"clean"==a&&window.localStorage.clear();window.location.reload(!0)},ping:cbx.doPing,loadcss:function(a){cbx.loadCSS(window,a)},loadsound:function(a){cbx.audio.setup(a)},tetris:function(){var a=window.open("","","width=400, height=600, resizable=yes");a.document.write('<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body id="bdy" style="position:absolute;margin:0;width:100%;height:100%;"></body></html>');
a.document.close();a.document.title="TETRIS!";var b=a.document.getElementById("bdy");a.onTetrisReady=function(d){d=new d(b);a.onresize=d.redraw;a.onblur=d.pause;a.onfocus=d.resume;d.start()};var c=a.document.createElement("script");c.src="//static.cbox.ws/jsc/tetris.js?1";b.appendChild(c)},wordsearch:function(a){a=a||"";var d=cbx.gsUser.get("nme")||"";window.open("http://www.cbox.ws/games/wordsearch/?name="+esc(d)+"#"+esc(a),"","width=750, height=800, resizable=yes")},sudoku:function(){window.open("http://www.cbox.ws/games/sudoku/",
"","width=600, height=800, resizable=yes")},help:function(){var a=[],c;for(c in b)a.push(c);add_priv_post("[HELP]",a.join(", "))},pm:function(a,b){if(a||b)return!0;statusBar.warn("Usage: //pm uid message<br>Or: //pm on|off")},colors:function(){cbx.colorPicker.toggle()},ignore:function(a){var b=cbx.gsUser.get("ignores")||[];a?-1<b.indexOf(a)?(b.splice(b.indexOf(a),1),cbx.gsUser.set("ignores",b),statusBar.set("User "+a+" no longer ignored.")):(b.push(a),cbx.gsUser.set("ignores",b),statusBar.set("User "+
a+" ignored")):(a="Not ignoring anyone yet. Use: //ignore username. ",b.length&&(a="Currently ignoring: "+b.join(", ")),statusBar.set(a))},menu:function(a){cbx.notifyParent("menu",a)},quote:function(a){var b=new XMLHttpRequest;b.onload=function(a){try{var d=JSON.parse(b.responseText);for(a=0;a<d.length;a++){var c=[Math.pow(2,32)+Math.floor(1E4*Math.random()),(new Date).getTime()/1E3|0,"Date string",d[a].title,1,d[a].link,d[a].content,"",0,1234,""].join("\t");cbx.parseMsg(c)}}catch(l){}};b.open("GET",
"http://quotesondesign.com/wp-json/posts?filter[orderby]=rand&filter[posts_per_page]="+(a||1)+"&cachebust="+Math.random());b.send()},quoteloop:function(){window.setInterval(b.quote,4E3)},trim:function(a){messages.trimTail(a||0)},rdebug:function(){cbx.showRemoteDebug=!cbx.showRemoteDebug;statusBar.set("Rdebug is "+(cbx.showRemoteDebug?"ON":"OFF"))},mark:function(){messages.setBookmark()},kick:function(a){var b=cbx.$frm;cbx.xhr("delban",{n:b.nme.value,k:b.key.value,kick:a},null,function(a,b){b&&statusBar.warn(b);
if(!a)return!1;statusBar.set(a)})},pin:function(a){if(a=messages.getData(messages.getById(a)))a.isPinned=!0,insertMessage(a)}};a=a.substring(2).split(" ");var e=a[0].toLowerCase();return b[e]?!b[e].apply(window,a.slice(1)):(statusBar.warn(e+": unknown command"),!0)};
cbx.loadCSS=function(a,c){var b=a.document.getElementsByTagName("head")[0];a=a.document.createElement("link");var e=b.getElementsByTagName("link"),d;for(d in e)"text/css"===e[d].type&&b.removeChild(e[d]);a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");a.setAttribute("href",c);b.appendChild(a);window.setTimeout(function(){cbx.rsz(!0)},50)};
cbx.replaceCSS=function(a){(function(c){for(var b=0;b<c.document.styleSheets.length;b++){var e=c.document.styleSheets[b];!e.href||0>e.href.indexOf("cbox")||(e.disabled=!0)}b=c.document.getElementById("__style");b||(e=c.document.getElementsByTagName("head")[0],b=c.document.createElement("style"),b.type="text/css",b.id="__style",e.insertBefore(b,e.firstChild));b.innerHTML=a})(window);window.setTimeout(function(){cbx.rsz(!0)},50)};
cbx.setStyle=function(a,c,b){var e=[];if(a&&c){var d=new RegExp("^"+a+"$","ig");(function(a){for(var f=0;f<a.document.styleSheets.length;f++){var h=a.document.styleSheets[f];if(h.href&&!(0>h.href.indexOf("cbox"))){if(h.cssRules&&h.cssRules.length){e=h.cssRules;break}if(h.rules&&h.rules.length){e=h.rules;break}}}for(f=0;f<e.length;f++)e[f]&&e[f].selectorText&&e[f].selectorText.match(d)&&(e[f].style[c]=b)})(window);window.setTimeout(function(){cbx.rsz(!0)},50)}};
cbx.rpcCommands={del:function(a){cbx.proc_rpc_del(a)},ping:function(a){a&&add_priv_post("[PING]","Ping reply (WS/LP): "+Math.round((new Date).getTime()-1*a)+" ms")},pm:function(a){a.split("-")[1]!==cbx.gsUser.get("uid")?(cbx.debug.log("Ignoring non-target PM "+a),deprIgnoreCount=1):(cbx.debug.log("Sent mark "+a),cbx.xhr("mark",null,{pm:a}))},mark:function(a){cbx.debug.log("Received mark for "+a);cbx.msgSetStatus(a,2)},typing:function(a){setTypingStatus(a)},blank:function(a){window.setTimeout(function(){Blank.set(a)},
2E3)},blankanon:function(a){cbx.gsUser.get("lpid")||cbx.gsUser.get("lvl")&&!(2>1*cbx.gsUser.get("lvl"))||Blank.set(a)},notice:function(a){a=a.split("\t");var c=overlay.create(a[1],"Notice");overlay.switchTo(c);c.body.textContent=a[0]},kick:function(a){a.split("\t")[0]===cbx.gsUser.get("uid")&&window.setTimeout(function(){Blank.set(0)},2E3)},setlvl:function(a){a=a.split("\t");a[0]===cbx.gsUser.get("uid")&&cbx.updateUser({lvl:a[1]})},debug:function(a){cbx.debug.log(a,"R_DEBUG");cbx.showRemoteDebug&&
add_priv_post("SERVER",a)},lcmd:function(a){cbx.cmdExec(a)}};var deprIgnoreCount=0;
cbx.rpcProcess=function(a,c){if("string"===typeof a&&a.length){var b=a.split("\n");window.setTimeout(function(){cbx.repl.sendmessage(a)},0);var e=cbx.rpcCommands;deprIgnoreCount=0;for(var d=!1,f=0;f<b.length;f++){var g=b[f];if(!(1>g.length)){var h="",k="";"<"==g.substring(0,1)&&(h=g.substring(1,g.indexOf("=")),k=g.substring(g.indexOf("=")+1));h?e[h]?e[h].call(window,k):c&&c(h,k):deprIgnoreCount?deprIgnoreCount--:(d=!0,cbx.parseMsg(g))}}d&&(msgToolsUpdate(),cbx.upd_tms())}};
cbx.doPing=function(){var a=(new Date).getTime();cbx.xhr("ping",{ping:a,rcid:cbx.arMgr.upstream},null,function(c,b){!c||b?"L-timeout"==b?statusBar.warn("Ping timeout"):statusBar.warn(b):(c=(new Date).getTime()-a,add_priv_post("[PING]","Ping sent OK (XHR): "+Math.round(c)+" ms"))});add_priv_post("[PING]","Ping sent")};
var relax=!1,do_refresh=function(a){cbx.autoScroll(!0);if(relax)return window.setTimeout(function(){a||statusBar.set(lang[10])},500),!1;relax=!0;window.setTimeout(function(){relax=!1},1E4);cbx.xhr("ar",{p:cbx.lp,c:cbx.unixTime()},null,function(c,b){statusBar.hide();a||(!c||b?statusBar.warn(b):cbx.aj_proc(c)||statusBar.set(lang[10]))});return!1},do_post=function(){var a=cbx.$frm,c=a.pst.value;if(cbx.cmdExec&&cbx.cmdExec(c))return cbx.setInputMode(),!1;if(!function(){if(!c)return statusBar.warn(lang[4]),
a.pst.focus(),!1;c=c.replace(/\n/g,"[br]");return config.uo?!0:a.nme.value?a.eml?""!=a.eml.value&&0>=a.eml.value.lastIndexOf(".")&&0>=a.eml.value.lastIndexOf("@")?(statusBar.warn(lang[6]),a.eml.focus(),!1):!0:!0:(statusBar.warn(lang[2]),a.nme.focus(),!1)}()||a.sub.disabled)return!1;overlay.switchTo();cbx.autoScroll(!0);cbx.setInputMode();var b=1E5*Math.random()|0;"undefined"===typeof cbx.fp&&cbx.FP.hash(function(a){cbx.fp=a});for(var e={aj:cbx.ver,lp:cbx.lp,pst:c,fp:cbx.fp,lid:b},d="nme eml key ekey fkey pic auth captme capword caphash".split(" "),
f=0;f<d.length;f++){var g=d[f];!a[g]||""===a[g].value||"eml"==g&&a[g].value==lang[5]||(e[g]=a[g].value)}sendBuffer.add(e,b);a.pst.focus();return!1},sendBuffer=function(){function a(a){return String(a).replace(/[&<>"'\/]/g,function(a){return b[a]})}var c=[],b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},e="idle",d=1,f=function(){if(c.length&&"idle"==e){var a=c.shift();e="sending";cbx.xhr("submit",null,a,function(b,g){e="sent";var h=b.split("\n")[0].split("\t"),k=cbx.$frm;
if(!b||h[0]||g){if(k.pst.value==lang[3]||""==k.pst.value)k.pst.value=a.pst;k=h[6];if("NEED_CAPTCHA"==k)showCaptcha();else if("NEED_LOGIN"!=k&&"MUST_REGISTER"!=k||!authBtnExtern){if(g){statusBar.error(g);return}statusBar.warn(h[0])}else authBtnExtern();if(g){e="error";window.setTimeout(function(){e="idle";f()},2E3*d);d++;return}}else d=1,cbx.gsUser.set("nme",k.nme.value),k.eml&&cbx.gsUser.set("eml",k.eml.value),k.pic&&cbx.gsUser.set("pic",k.pic.value);c.length?(e="waiting",window.setTimeout(function(){e=
"idle";f()},250)):e="idle";cbx.aj_proc(b)})}};return{add:function(b){c.push(b);insertMessage({id:"L"+b.lid,unixtime:0,datestr:"",namehtml:a(b.nme),imgurl:b.pic,exturl:b.eml,msghtml:a(b.pst),isLocal:!0});f()}}}();cbx.msgSetStatus=function(a,c){if(a=messages.getById(a)){for(var b=["","Sent","Delivered"],e=a.className.split(/\s+/),d=[b[c]],f=0;f<e.length;f++)e[f]!==b[c]&&d.push(e[f]);a.className=d.join(" ")}};
var ovrCaptcha=overlay.create("Captcha","Captcha"),showCaptcha=function(){overlay.switchTo(ovrCaptcha);cbx.xhr("captcha",{xhr:1},null,function(a,c){ovrCaptcha.body.innerHTML=a;a=document.getElementById("cthash");var b=document.getElementById("ctinput");c=document.getElementById("cttme");var e=document.forms.cbox;if("undefined"===typeof e.caphash){var d=document.createElement("input");d.name="caphash";d.type="hidden";e.appendChild(d);d=document.createElement("input");d.name="captme";d.type="hidden";
e.appendChild(d);d=document.createElement("input");d.name="capword";d.type="hidden";e.appendChild(d)}e.caphash.value=a.value;e.captme.value=c.value;e.capword.value=b.value;b.focus();b.onkeyup=function(){e.capword.value=b.value};b.onkeydown=function(a){a=a||window.event;13==(a.keyCode||a.which)&&window.do_post()}})};
cbx.aj_proc=function(a){var c=a.split("\n"),b=c[0].split("\t");if(!a)return!1;a=c.slice(1);a.length&&a.reverse();cbx.rpcProcess(a.join("\n"));b[3]&&cbx.updateUser({key:b[3]});b[2]&&(c=Math.round(1*b[2]-(new Date).getTime()/1E3))&&cbx.gsPrefs.set("timeDelta",c);b[5]&&(cbx.gsUser.set("lpid",Math.max(b[5],cbx.gsUser.get("lpid"))),cbx.msgSetStatus(b[5],1));return a.length};
cbx.updateUser=function(a){cbx.debug.log("Got user data: "+JSON.stringify(a),"UDATA");if(a&&"object"===typeof a){"key"in a&&(cbx.$frm.key.value=a.key,cbx.gsUser.set("key",a.key));"nme"in a&&a.nme&&(cbx.$frm.nme.value=a.nme,cbx.gsUser.set("nme",a.nme));"url"in a&&a.url&&(cbx.$frm.eml&&(cbx.$frm.eml.value=a.url),cbx.gsUser.set("eml",a.url));"pic"in a&&a.pic&&(cbx.$frm.pic&&(cbx.$frm.pic.value=a.pic),cbx.gsUser.set("pic",a.pic));if("uid"in a){var c=cbx.gsUser.get("uid");cbx.gsUser.set("uid",a.uid);a.uid!=
c&&cbx.presMgr.sendPing(null)}"lvl"in a&&(a=1*a.lvl,c=cbx.gsUser.get("lvl"),cbx.gsUser.set("lvl",a),classToggle(document.body,"UserAuthed",1<a),classToggle(document.body,"UserIsMod",3==a),classToggle(document.body,"UserIsAdmin",4==a),a!=c&&msgToolsUpdate())}};
cbx.presMgr={state:0,ivalPing:12E4,lastPingTme:0,sendPing:function(a){a={state:a||"online",vstate:userViewMon&&userViewMon.state,wtop:userViewMon&&userViewMon.props&&userViewMon.props.istop,n:cbx.$frm.nme.value,k:cbx.$frm.key.value,rcid:cbx.arMgr.upstream||"",rcad:cbx.arMgr.adapter||"",clid:cbx.repl.clientID,msid:cbx.repl.masterID||""};cbx.debug.log("Sending","PRES");cbx.presMgr.lastPingTme=(new Date).getTime();cbx.xhr("users",null,a,function(a,b){cbx.presMgr.state=b?1:3})},run:function(){cbx.presMgr.state=
1;var a=function(){var a=(new Date).getTime(),b=cbx.presMgr.lastPingTme;b&&a-b<cbx.presMgr.ivalPing||cbx.presMgr.sendPing(null)};window.setTimeout(function(){cbx.presMgr.state=2;cbx.debug.log("Starting passive loop","PRES");a();window.setInterval(a,5E3)},8E3)},stop:function(){}};
cbx.arMgr={state:0,backoff:1E3,tmr:null,adapter:"",upstream:null,onconnect:null,run:function(){var a=cbx.arMgr.state=1,c=function(){cbx.arMgr.backoff=Math.min(36E4,Math.floor(cbx.arMgr.backoff*(1.5+Math.random())))},b=function(){cbx.arMgr.backoff=Math.floor(1E3*(2+8*Math.random()))},e=function(a){cbx.debug.log(a,"ARMGR")},d=function(b,d){e(cbx.arMgr.state+"->"+b+" "+d);b!=cbx.arMgr.state&&(classToggle(document.body,"Connected",4==b),classToggle(document.body,"Connecting",2==b),classToggle(document.body,
"Connwait",0==b),cbx.arMgr.state=a=b)},f=function(a,b){null!==cbx.arMgr.tmr&&(window.clearTimeout(cbx.arMgr.tmr),cbx.arMgr.tmr=null);a&&(cbx.arMgr.tmr=window.setTimeout(function(){e("Timer fired");a()},b))},g=function(a,c){if(cbx.arMgr.upstream!==c&&(d(4,a+" ("+c+") connected. Prev: "+cbx.arMgr.adapter+" ("+cbx.arMgr.upstream+")"),cbx.arMgr.upstream=c,cbx.arMgr.adapter=a,b(),f(null),"function"===typeof cbx.arMgr.onconnect))cbx.arMgr.onconnect(c)},h=function(){d(2,"Starting LP");cbx.lpconn.onstatechange=
function(a){4===a&&g("LP",cbx.lpconn.id+"_"+cbx.lpconn.hash)};cbx.lpStart();f(null)},k=!1,l=!0,n=0,m=function(){d(2,"Attempting WS");r();c();f(h,3E4+cbx.arMgr.backoff);try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),l=!1}catch(u){navigator.mimeTypes["application/x-shockwave-flash"]&&(l=!1)}cbx.wsconn.onstatechange=function(b){2===a&&2===b?l=!0:2===a&&0===b?(d(0,"WS failed without connection. "),2<++n&&!k?(e("Too many WS fails; switching to LP"),h()):k?f(m,cbx.arMgr.backoff):l?f(h,cbx.arMgr.backoff):
f(p,cbx.arMgr.backoff)):2===a&&4===b?(g("WS",wsconn.id+"_"+wsconn.hash),k=!0,n=0,cbx.lpStop(),cbx.flconn.onmessage=null):4===a&&0===b&&(d(0,"WS disconnected. Retrying in "+cbx.arMgr.backoff),cbx.wsconn.onstatechange=null,f(m,cbx.arMgr.backoff))};wsStart("https:"===window.location.protocol?config.wsuri_https:config.wsuri)},p=function(){d(2,"Attempting FL");c();f(h,15E3+cbx.arMgr.backoff);cbx.flconn.onstatechange=function(b){2===a&&0==b?(d(0,"FL failed without connection. "),f(null),h()):2===a&&4===
b?g("FL",flconn.id+"_"+flconn.hash):4===a&&0==b&&(d(0,"FL disconnected"),cbx.flconn.onstatechange=null,f(p,cbx.arMgr.backoff))};startFlashRelay()},r=function(){cbx.repl.onstatechange=null;cbx.repl.onmessage=null;cbx.rpcCommands.upstream=null};(function(){d(1,"Attempting Repl");c();f(m,5E3+cbx.arMgr.backoff);cbx.repl.onstatechange=function(c){2===c?(e("Repl is master (disconnected); falling through"),r(),b(),window.setInterval(function(){var a=4===wsconn.state?wsconn:null;a=4===flconn.state?flconn:
a;(a=4===lpconn.state?lpconn:a)&&cbx.repl.sendmessage("<upstream="+a.id+"_"+a.hash+"\n")},2E3),m()):1===a&&4===c&&(d(3,"Repl is slave; awaiting upstream..."),f(m,15E3+cbx.arMgr.backoff),cbx.repl.onmessage=function(a){cbx.rpcProcess(a)},cbx.rpcCommands.upstream=function(a){g("RP",a)})};cbx.repl.start(config.id+"_"+config.tid)})()},stop:function(){}};var lpconn={enabled:!1,state:0,tmeLastRequest:0,curWait:0,lastErr:null,numMessages:0,numRequests:0,id:"",hash:"",pool:"",onstatechange:null};
cbx.lpconn=lpconn;cbx.lpStop=function(){cbx.lpconn.enabled=!1};cbx.lpStart=function(){var a=cbx.lpconn.enabled;cbx.lpconn.enabled=!0;cbx.lpconn.state=1;a||cbx.lpLoop()};
cbx.lpLoop=function(){var a=function(a){cbx.debug.log(a,"LP-XHR")},c=function(b,c){if(b!=cbx.lpconn.state&&(a(cbx.lpconn.state+"->"+b+(c?" | "+c:"")),cbx.lpconn.state=b,cbx.lpconn.onstatechange))cbx.lpconn.onstatechange(b)};cbx.lpconn.numRequests++;cbx.lpconn.tmeLastRequest=(new Date).getTime();var b=null;window.XDomainRequest?(b=new XDomainRequest,a("Using XDR")):b=new XMLHttpRequest;var e=!1,d=function(a){cbx.lpconn.curWait=1*Math.min(a,12E4)|0;window.setTimeout(function(){cbx.lpconn.enabled?cbx.lpLoop():
c(0)},cbx.lpconn.curWait)},f=!1,g=function(g){if(!e){e=!0;cbx.lpconn.lastErr=null;var h=(new Date).getTime()-cbx.lpconn.tmeLastRequest;g=Math.max(0,2E3-h)+4E3*Math.random();var k=Math.max(8E3,cbx.lpconn.curWait)*(1.5+Math.random()),m=b.responseText;200<b.status||200>b.status?(cbx.lpconn.lastErr="HTTP "+b.status,a("Got bad HTTP status "+b.status),d(k)):m?(h=flareUnescape(m)||"",cbx.rpcProcess(h,function(a,b){"hash"==a&&(2<cbx.lpconn.state&&c(2,"Got hash while in state 3/4: returning to 2"),cbx.lpconn.hash=
b);"id"==a&&(cbx.lpconn.id=b);"pool"==a&&(cbx.lpconn.pool=b,f=!0,window.setTimeout(function(){f=!1},200));cbx.lpconn.id&&cbx.lpconn.hash&&2<=cbx.lpconn.state&&4>cbx.lpconn.state&&(f?c(4,"Registered"):(c(3,"Registering..."),cbx.xhr("relayreg",{cid:cbx.lpconn.id,chash:cbx.lpconn.hash,m:"lp"})))}),d(g),cbx.lpconn.numMessages++):(cbx.lpconn.lastErr="Empty",a("Got empty response"),d(5E4<h?g:k))}};b.onload=g;b.onerror=g;b.onreadystatechange=function(){4==b.readyState&&g()};b.timeout=32E4;var h=("https:"===
window.location.protocol?config.lpuri_https:config.lpuri)+"/"+cbx.lpconn.id+"_"+cbx.lpconn.hash+flarePoolGetQS();b.open("GET",h);window.setTimeout(function(){b.send();1==cbx.lpconn.state&&c(2)},0);a("GET "+h);return!0};var flconn={id:null,hash:null,pool:null,state:0,numAttempts:0,numCommands:0,numMessages:0,onstatechange:null,onmessage:null};cbx.flconn=flconn;
var startFlashRelay=function(){var a=null,c=null,b=function(a){if(a!=flconn.state&&(flconn.state=a,flconn.onstatechange))flconn.onstatechange(a)},e=function(b,c){null!=a&&(window.clearTimeout(a),a=null);b&&(a=window.setTimeout(function(){cbx.debug.log("Timer fired","FLAR");b()},c))},d=function(){cbx.debug.log("Failed","FLAR");flconn.pool=null;flconn.id=null;flconn.hash=null;b(0);e(null)};cbx.flconn.onmessage=function(a){flconn.numMessages++;4===flconn.state&&e(d,18E4);cbx.rpcProcess(a,function(a,
c){flconn.numCommands++;"pool"==a&&(flconn.pool=c);"hash"==a&&(flconn.hash=c);"id"==a&&(flconn.id=c);2>flconn.state||3<flconn.state||!flconn.id||!flconn.hash||(flconn.pool?(cbx.debug.log("Registered","FLAR"),b(4),e(d,18E4)):(cbx.debug.log("Registering","FLAR"),b(3),e(d,1E4),cbx.xhr("relayreg",{cid:flconn.id,chash:flconn.hash,m:"fl"})))})};b(1);cbx.debug.log("Loading","FLAR");window.fl_ready=function(){e(d,1E4);c.doConn()};window.fl_gotconn=function(){b(2);e(d,1E4)};window.fl_pclosed=function(){cbx.debug.log("Closed",
"FLAR");d()};window.fl_gotmsg=function(a){if(cbx.flconn.onmessage)cbx.flconn.onmessage(a)};c=loadSWF("ARswf",config.fluri);e(d,1E4)},flareUnescape=function(a){var c={"\\\\":"\\","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return a.replace(/(\\\\)|(&amp;)|(&lt;)|(&gt;)|(&quot;)|(&#039;)/g,function(a){return c[a]})},flarePoolGetQS=function(){return"?pool="+[config.id,config.tid,config.flr_tok].join("-")},wsconn={id:null,hash:null,pool:null,state:0,tmeAttempted:0,tmeOpened:0,tmeHalfEst:0,
tmeCompleted:0,numAttempts:0,curAttempts:0,curBackoff:0,numCommands:0,numMessages:0,log:[],onstatechange:null,socket:null,tmr:null};cbx.wsconn=wsconn;
var wsStart=function(a){var c=function(a){cbx.debug.log(a,"WS")},b=function(a){if(a!=wsconn.state&&(wsconn.state=a,wsconn.onstatechange))wsconn.onstatechange(a)},e=function(a,b){null!==wsconn.tmr&&(window.clearTimeout(wsconn.tmr),wsconn.tmr=null);a&&(wsconn.tmr=window.setTimeout(function(){c("Timer fired");a()},b))};try{wsconn.tmeAttempted=(new Date).getTime();wsconn.numAttempts++;wsconn.curAttempts++;c("OPENING "+a+flarePoolGetQS());var d=function(){e(null);wsconn.id=null;wsconn.hash=null;wsconn.pool=
null;0<wsconn.state&&(f.close(),b(0))};b(1);e(d,2E4);wsconn.socket&&(wsconn.socket.onclose=function(){},wsconn.socket.onerror=function(){},wsconn.socket.close(),wsconn.socket=null);wsconn.socket=new WebSocket(a+flarePoolGetQS());var f=wsconn.socket;f.onopen=function(){b(2);c("OPEN");e(d,5E3);wsconn.tmeOpened=(new Date).getTime();wsconn.curAttempts=0};f.onclose=function(a){c("CLOSE "+(a.wasClean?"CLEAN":"UNEXPECTED")+" ("+a.code+") "+a.reason);d()};f.onerror=function(a){c("ERROR");d()};f.onmessage=
function(a){wsconn.numMessages++;4===wsconn.state&&e(d,18E4);a=flareUnescape(a.data);cbx.rpcProcess(a,function(a,f){wsconn.numCommands++;"pool"==a&&(wsconn.pool=f);"hash"==a&&(wsconn.hash=f);"id"==a&&(wsconn.id=f);2>wsconn.state||3<wsconn.state||!wsconn.id||!wsconn.hash||(wsconn.pool?(c("Registered downlink"),b(4),e(d,18E4),wsconn.tmeCompleted=(new Date).getTime()):(c("Registering downlink"),b(3),e(d,15E3+5E3*Math.random()),wsconn.tmeHalfEst=(new Date).getTime(),cbx.xhr("relayreg",{cid:wsconn.id,
chash:wsconn.hash,m:"ws"})))})}}catch(g){return c("Caught exception: "+g.message),e(null),b(0),!1}},rand=function(a,c){a=Math.ceil(a);c=Math.floor(c);return Math.floor(Math.random()*(c-a+1))+a},initOnliners=function(){var a=function(a){cbx.debug.log(a,"ONLRS")},c=overlay.create("Online users","Users"),b=document.getElementById("users"),e=0,d="",f=function(a){var b=cbx.gsUser.get("lvl"),c=cbx.gsUser.get("uid"),d=a.querySelectorAll("img.pic");for(a=0;a<d.length;a++)(function(a){a.onclick=function(){showFullImage(a.src)}})(d[a]);
d=l().getElementsByClassName("usr");for(a=0;a<d.length;a++){var e=d[a],f=[];(function(a,d){config.pm&&0<a.id&&c&&a.id!=c&&(2<b||2<a.lvl)&&f.push({cN:"Envelope",text:lang[15],call:function(){cbx.setInputMode("//pm "+a.id);msgTools.close();return!1}});2<b&&a.id!=c&&b>a.lvl&&4>a.lvl&&(f.push({cN:"Kick",text:"Kick user",call:function(){cbx.cmdExec("//kick "+a.id);msgTools.close();return!1}}),f.push({cN:"Ban",text:lang[18],call:function(b){cbx.ban(a.id,b.element());msgTools.close();return!1}}));var e=
d.getElementsByClassName("msgtools");e.length&&d.removeChild(e[0]);f.length&&(e=msgTools.create(f),d.insertBefore(e,d.firstChild))})(k(e),e)}},g=null,h=function(){null!==g&&(window.clearTimeout(g),g=null);for(var a=l().getElementsByClassName("usr"),b=0;b<a.length;b++){var c=a[b],d=k(c);c=c.getElementsByClassName("dtxt")[0];d.updtme&&c&&(c.innerHTML=relTime(d.updtme).str)}g=window.setTimeout(h,3E4)},k=function(a){return a?{id:a.getAttribute("data-id"),lvl:a.getAttribute("data-lvl"),nme:a.getElementsByClassName("nme")[0].textContent,
pres:a.getAttribute("data-pres"),updtme:a.getAttribute("data-pres-time")}:{}},l=function(){return c.isVisible?c.body:b},n=null,m=0,p=function(){"LOADING"!=d&&(n&&(window.clearTimeout(n),n=null),d="LOADING",e=(new Date).getTime(),cbx.xhr("onliners",{xhr:1},null,function(b,c){if(c){if(3<m){a("Init failed and retries exhausted.");d="FAILED";return}a("Init failed. Retry after delay...");d="FAIL_RETRY";n=window.setTimeout(p,++m*rand(2,5)*1E3)}m=0;d="LOADED";c=l();c.innerHTML=b;f(c);t(null,null);h()}))},
r=null,u=function(b){if("LOADED"===d){for(var c=l(),e=c.getElementsByClassName("usr"),f=!1,g=0;g<e.length;g++)e[g]&&e[g].getAttribute("data-id")==b&&(classToggle(e[g],"Left",!0),f=!0);null!==r&&window.clearTimeout(r);r=window.setTimeout(function(){for(var a=c.querySelectorAll(".usr.Left"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},2E3);a("Removing user "+b+": "+f);f&&t(null,null)}},q=null,v=null,t=function(a,b){if("LOADED"===d){var c=l(),e=c.getElementsByClassName("usr");c=c.querySelector(".notUsr > span");
v=e.length;"anon"===b&&(q=a);c&&("anon"!==b&&(q=1*c.innerHTML),c.innerHTML=q)}else"total"===b&&(v=a,q=0);a=v+q;cbx.onlinerBtn.text(a);cbx.notifyParent("onliners",a)};cbx.onlinerBtn=makeButton("Users","0","Users online",function(){b&&b.clientWidth||c.isVisible?(overlay.switchTo(),classToggle(document.body,"WithUserPanel",!1)):(classToggle(document.body,"WithUserPanel",!0),p(),b&&b.clientWidth||(classToggle(document.body,"WithUserPanel",!1),overlay.switchTo(c)))},"btnOnliners");t(1*config.onu,"total");
cbx.onlinerBtn.enable();cbx.rpcCommands.ujoin=function(b){if("LOADED"===d){var c=l(),e=c.children,g=document.createElement("div");g.innerHTML=b;var h=g.getElementsByClassName("usr")[0];b=k(h);a("Adding user "+b.id);u(b.id);for(g=0;g<e.length&&-1!=e[g].className.indexOf("usr");g++){var m=e[g].getAttribute("data-lvl");if(m<b.lvl)break;if(m==b.lvl&&e[g].getElementsByClassName("nme")[0].textContent.toLowerCase()>b.nme.toLowerCase())break}classToggle(h,"Joined",!0);c.insertBefore(h,e[g]);window.setTimeout(function(){classToggle(h,
"Joined",!1)},0);t(null,null);f(c)}};cbx.rpcCommands.uleave=u;cbx.rpcCommands.updusrcnt=function(a){t(1*a,"total")};cbx.rpcCommands.uanoncnt=function(a){t(1*a,"anon")};cbx.rpcCommands.upres=function(a){if("LOADED"===d){var b=a.split("\t");a=b[0];b=b[1];for(var c=l(),e=c.getElementsByClassName("usr"),g=0;g<e.length;g++)if(e[g]&&e[g].getAttribute("data-id")==a){e[g].setAttribute("data-pres",b);e[g].setAttribute("data-pres-time",cbx.unixTime());break}f(c)}};var w=cbx.arMgr.onconnect;cbx.arMgr.onconnect=
function(){w();"LOADED"===d&&1E4<(new Date).getTime()-e&&p()};classState(document.body,"WithUserPanel")&&window.setTimeout(function(){p()},10)},Tooltip=function(){var a=null,c=function(){if(a)return a;a=document.createElement("div");a.id="tooltip";document.body.appendChild(a);return a},b=!1,e=function(a,b){var d=c();d.style.top="0px";d.style.left="0px";d.textContent=a;classToggle(d,"Visible",!0);a=b.getBoundingClientRect();var e=d.getBoundingClientRect();b=e.right-e.left;var f=document.documentElement.clientWidth,
g=a.left;e=a.top-(e.bottom-e.top);g+b>f&&(g=f-b-2);0>e&&(e=a.bottom);d.style.top=e+"px";d.style.left=g+"px"},d=function(){var a=c();classToggle(a,"Visible",!1)},f=null,g=function(){this.tooltip&&(f&&(window.clearTimeout(f),f=null),d(),f=window.setTimeout(function(){b=!1},500))},h=function(){var a=this.tooltip,c=this.tooltipRef;a&&(f&&(window.clearTimeout(f),f=null),b?e(a,c):f=window.setTimeout(function(){b=!0;e(a,c)},500))};return function(a,b,c){!a.tooltip&&b&&(a.addEventListener("mouseenter",h),
a.addEventListener("focus",h),a.addEventListener("mouseleave",g),a.addEventListener("mouseup",g),a.addEventListener("blur",g));a.tooltip=b;a.tooltipRef=c}}(),makeCtxmenu=function(){var a=null,c=function(){if(a)return a;a=document.createElement("div");a.id="menu";document.body.appendChild(a);return a},b=!1,e=function(){var a=c();classToggle(a,"Visible",!1);b=!1};document.documentElement.addEventListener("mousedown",function(c){if(b){c=c.target;do if(c===a)return;while(c=c.parentElement);e()}},{passive:!0});
var d=null;return function(){var a=document.createDocumentFragment(),g={frag:a,add:function(b){a.appendChild(b);return g},show:function(a){var e=c();if(d)for(;0<e.childNodes.length;)d.frag.appendChild(e.childNodes[0]);e.innerHTML="";e.appendChild(g.frag);e=c();e.style.top="0px";e.style.left="0px";classToggle(e,"Visible",!0);a=a.getBoundingClientRect();var f=e.getBoundingClientRect(),h=f.right-f.left,m=document.documentElement.clientWidth,p=a.left;f=a.top-(f.bottom-f.top);p+h>m&&(p=m-h);0>f&&(f=a.bottom);
e.style.top=f+"px";e.style.left=p+"px";b=!0;return d=g},hide:e};return g}}(),Emotes=function(){var a=[],c=null;return{enqueueAll:function(b){b=b.querySelectorAll(".imgBox.Defer");for(var c=0;c<b.length;c++)b[c].getAttribute("data-state")||(a.push(b[c]),b[c].setAttribute("data-state","queued"))},load:function(){null!==c&&(window.clearTimeout(c),c=null);c=window.setTimeout(function(){for(var b=0;b<a.length;b++){var c=a[b];if(c&&"queued"===c.getAttribute("data-state")){var d=c.getBoundingClientRect();
!d||!d.height&&!d.width||!document.documentElement.clientHeight||d.top>=document.documentElement.clientHeight||0>d.bottom||(d=new Image,d.src=c.getAttribute("data-url"),c.setAttribute("data-state","loading"),c.appendChild(d),c.getAttribute("data-alt")&&(d.alt=c.getAttribute("data-alt")),c.getAttribute("data-tooltip")&&Tooltip(d,c.getAttribute("data-tooltip"),d),a.splice(b--,1))}else a.splice(b--,1)}},400)}}}(),scrollFollow=!0,scrollHeightPrev=null,keepScrollTmr=null,keepScrollCnt=0,loadingOlderMsgs=
!1,noMoreOlder=!1,isPaused=!1,sTprev=0,tmrScrollFuncGate=null,onScrollFunc=function(a){var c=document.getElementById("messages"),b=c.clientHeight||Infinity,e=c.scrollTop||0;c=c.scrollHeight;b=config.bs&&e+b>c-10||!config.bs&&10>e;!scrollFollow&&b||!0===a?(cbx.debug.log("Scroll locked ",a),scrollFollow=!0):(scrollFollow&&!b&&!1!==a&&(scrollFollow=!1,cbx.refreshBtn.icon(config.bs?"DoubleDown":"DoubleUp").onclick(function(){cbx.autoScroll(!0);return!1}).enable()),Emotes.load())};
cbx.autoScroll=function(a){var c=document.getElementById("messages");c?(a=a||!1,window.setTimeout(function(){null!==keepScrollTmr&&(window.clearTimeout(keepScrollTmr),keepScrollTmr=null);"addEventListener"in c?c.removeEventListener("scroll",onScrollFunc,{passive:!0}):c.onscroll=null;a&&(scrollFollow=!0);scrollFollow&&!isPaused&&cbx.refreshBtn.icon("Circle").disable();cbx.rsz(!1);window.onresize=cbx.rsz;var b=Math.max(document.body&&document.body.scrollHeight,c&&c.scrollHeight,document.documentElement&&
document.documentElement.scrollHeight);scrollFollow?c.scrollTop=config.bs?b:0:!config.bs&&scrollHeightPrev&&b-scrollHeightPrev&&(c.scrollTop+=b-scrollHeightPrev);b!==scrollHeightPrev&&cbx.notifyParent("heightchange",b);scrollHeightPrev=b;null!==tmrScrollFuncGate&&(window.clearTimeout(tmrScrollFuncGate),tmrScrollFuncGate=null);tmrScrollFuncGate=window.setTimeout(function(){"addEventListener"in c?c.addEventListener("scroll",onScrollFunc,{passive:!0}):c.onscroll=onScrollFunc;onScrollFunc(a)},100);keepScrollTmr=
window.setTimeout(cbx.autoScroll,500);if(unreadMessages[0]){b=document.getElementById("messages").getBoundingClientRect();do{var e=unreadMessages[0].getBoundingClientRect();if(!e||!e.top&&!e.bottom)break;if(config.bs&&e.bottom>b.bottom)break;if(!config.bs&&e.top<b.top)break;unreadMessages.shift().classList.remove("Unread")}while(unreadMessages[0])}b=unreadMessages.length||0;b+=droppedMessages;cbx.refreshBtn.text(b||"");var d=document.getElementById("olderMsgs");if(d){b=document.getElementById("messages").getBoundingClientRect();
e=d.getBoundingClientRect();var f=Math.max(.2*b.height,50);!(config.bs&&e.top>b.top-f||!config.bs&&e.bottom<b.bottom+f)||loadingOlderMsgs||noMoreOlder||(d.innerHTML="Loading...",loadingOlderMsgs=!0,cbx.xhr("archive",{xhr:1,i:messages.getOldestID()},null,function(a,b){loadingOlderMsgs=!1;if(b||!a)d.innerHTML="No more messages",noMoreOlder=!0;else{b=c.scrollHeight;var e=c.scrollTop;d.insertAdjacentHTML(config.bs?"afterend":"beforebegin",a);loadingOlderMsgs=!1;d.innerHTML="&nbsp;";config.bs&&(c.scrollTop=
e+(c.scrollHeight-b));scrollHeightPrev=c.scrollHeight;msgToolsUpdate();cbx.upd_tms()}}))}scrollFollow&&!loadingOlderMsgs&&c.clientHeight&&c.scrollHeight>10*c.clientHeight&&(messages.trimTail(Math.floor(.8*messages.getCount())),noMoreOlder=!1);!scrollFollow&&!loadingOlderMsgs&&500<messages.getCount()&&(cbx.refreshBtn.icon("CirclePlay").onclick(function(){isPaused=!1;droppedMessages=0;do_refresh(!0);return!1}).enable(),isPaused=!0)},10)):cbx.debug.log("No messages container","SCROLL")};
cbx.rsz=function(a){a=cbx.$frm;var c=document.documentElement.clientWidth,b=document.documentElement.clientHeight;if(b&&c){cbx.rszH=b;cbx.rszW=c;var e=a.clientHeight;a=function(a,c){a.style.overflow="auto";a.scrollHeight<=b-e?a.style[c]="auto":(a.style[c]="0px",a.scrollHeight<=b-e&&(a.style.overflow="hidden",a.style[c]="auto"))};c=document.getElementById("overlay");var d=document.getElementById("messages"),f=document.getElementById("users"),g=document.getElementById("typingStatus");overlay.setFull(c.scrollHeight>=
b-e);config.ft?(d.style.top=f.style.top=c.style.top=g.style.top=e+"px",a(d,"bottom"),a(c,"bottom"),a(f,"bottom")):(d.style.bottom=f.style.bottom=c.style.bottom=g.style.bottom=e+"px",a(d,"top"),a(c,"top"),a(f,"top"))}else cbx.debug.log("Bailed on dims "+c+"x"+b,"RSZ")};
var pop=function(a,c,b,e,d){cbx.debug.log("Opening pop "+a+" at "+c+" x "+b,"POP");var f=window.open(a,"cb"+config.id+a,"width="+c+",height="+b+",toolbar=no,scrollbars="+e+",status=no,resizable=yes");window.setTimeout(function(){var a=screen.width,d=screen.height,e=screen.availLeft||0,l=screen.availTop||0;f.focus();window.setTimeout(function(){f.moveTo(e+a/2-c/2-100,l+d/2-b/2)},50)},10);d&&(window.openerCallback=d);return f};function esc(a){return encodeURIComponent(a)}
cbx.unixTime=function(){var a=cbx.gsPrefs.get("timeDelta")||0;return Math.round((new Date).getTime()/1E3)+a};
cbx.xhr=function(a,c,b,e){var d=null,f=null;e=e||function(){};var g=function(a){var b=[],c;for(c in a)b.push(c+"="+esc(a[c]));return b.join("&")},h=function(a){a=a||lang[14]+"E-Unknown";window.clearTimeout(f);null!==d&&(d.onreadystatechange=function(){},d.abort(),d=null);e("",a)},k=["./?sec="+a,config.rq,"_v="+cbx.ver],l=g(c);l&&k.push(l);k=k.join("&");if(window.XMLHttpRequest)d=new XMLHttpRequest;else if(window.ActiveXObject)try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){try{d=new ActiveXObject("Microsoft.XMLHTTP")}catch(p){}}d||
h(lang[14]+"L-JS");var n="-";d.onreadystatechange=function(){if(4==d.readyState){n=d.status;window.clearTimeout(f);var a=" ("+n+")";if(0==d.status)return h(lang[14]+"L-network"+a);if(200!=d.status)return h(lang[14]+"R-server"+a);var b=d.responseText,c=b.substring(0,1);b=b.substring(1);if("1"!=c&&"0"!=c)return h(lang[14]+"R-chksum"+a);if("0"==c)return h(""+b);e(b,null)}};d.onerror=function(a){h("Internet connection failure.")};f=window.setTimeout(function(){h("L-timeout")},2E4);l=b?"POST":"GET";d.open(l,
k,!0);d.setRequestHeader("Accept","*/*");d.responseType="text";b?(d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(g(b))):d.send();try{cbx.debug.log(l+" "+a+" "+JSON.stringify(c)+" "+JSON.stringify(b),"XHR")}catch(m){cbx.debug.log(l+" "+a+" [Error logging data]","XHR")}};
var statusBar=function(){var a=null,c=null,b=null,e=function(){var a=document.getElementById("barNotice"),b=document.getElementById("barDefault"),c=document.getElementById("barTitle");a.className="bar Hide";overlay.getCurrent()?c.className="bar":b.className="bar"},d=function(d,g){var f=document.getElementById("barNotice"),k=document.getElementById("barDefault"),l=document.getElementById("barTitle");cbx.debug.log(d?d:"(Hide)","STATUS");null!==a&&(window.clearTimeout(a),a=null);null!==c&&window.clearInterval(c);
b||(b=makeButton("Cancel Right","","",function(){e()},"btnStatus").enable());if(d){b.text(d);f.className="bar "+(g?g:"Warn");k.className="bar Hide";l.className="bar Hide";var n=document.querySelector("#btnStatus span"),m=0;n.offsetWidth>f.clientWidth-60&&(c=window.setTimeout(function(){var a=function(){32==d.charCodeAt(m)&&m++;b.text(d.substring(m));m+=1;n.offsetWidth>f.clientWidth-60?c=window.setTimeout(a,90):(m=0,c=window.setTimeout(function(){b.text(d);c=window.setTimeout(a,1E3)},1E3))};a()},1E3));
cbx.autoScroll(!1);a=window.setTimeout(e,Math.max(3E3,d.length/8*1E3))}else e()};return{error:function(a){d(a,"Error")},warn:function(a){d(a,"Warn")},set:function(a){d(a,"Okay")},hide:e}}(),setTypingStatus=function(){var a=null;return function(c){var b=document.getElementById("typingStatus");b.innerHTML=c?c:"";null!==a&&(window.clearTimeout(a),a=null);c?(b.className="Show",a=window.setTimeout(function(){b.className="SlowHide"},5E3)):b.className=""}}();
cbx.parseMsg=function(a){if(a=msgFromTSF(a)){var c=insertMessage(a);c&&(parseMsgTags(c),a.isUpdate||(cbx.notifyParent("message",null),cbx.newMessageAsync()))}};
var parseMsgTags=function(a){if(a.getElementsByClassName){var c=a.getElementsByClassName("atname");a=a.getElementsByClassName("bbUser");if(c||a){var b="";cbx.$frm.nme.value&&(b=cbx.$frm.nme.value.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));for(var e=new RegExp("^@?"+b+"$"),d=0;d<c.length;d++){var f=c[d];if(!b)break;if(f&&f.textContent&&f.textContent.match(e)){audioPlay("volTag");break}}for(d=0;d<a.length;d++)if(f=a[d],f.getAttribute&&cbx.gsUser.get("uid")&&f.getAttribute("data-uid")==cbx.gsUser.get("uid")){audioPlay("volTag");
break}}}};cbx.newMessageTmr=null;cbx.newMessageAgain=!1;cbx.newMessageAsync=function(){if(cbx.newMessageTmr)return cbx.newMessageAgain=!0,!1;audioPlay("volAll");titleflash();cbx.newMessageTmr=window.setTimeout(function(){cbx.newMessageTmr=null;cbx.newMessageAgain&&(cbx.newMessageAgain=!1,cbx.newMessageAsync())},1E3)};
var add_priv_post=function(a,c){a={id:"P"+(1E4*Math.random()|0),unixtime:cbx.unixTime(),datestr:"",namehtml:a,usrlvl:0,exturl:"",msghtml:c,bad_flags:32,isServer:!0};insertMessage(a);cbx.upd_tms()},msgFromTSF=function(a){a=a.split("\t");if(!a||7>a.length)return cbx.debug.log("Badly formed; ignoring","MSGTSF"),null;a={id:a[0],unixtime:a[1],datestr:a[2],namehtml:a[3],usrlvl:a[4],exturl:a[5],msghtml:a[6],imgurl:a[7],bad_flags:a[8],uid:a[9],flaghtml:a[10],localID:a[11]};a.isRedirected=!!(a.bad_flags&16);
a.isPrivate=!!(a.bad_flags&32);a.isSticky=-1==a.id;a.isTemp=0==a.id;return a},messages={getCount:function(){return document.querySelectorAll("#messages > .msg").length},getById:function(a){return document.querySelector('#messages > .msg[data-id="'+a+'"]')},getAll:function(){return document.querySelectorAll("#messages > .msg")},getData:function(a){if(a){var c={};c.uid=a.getAttribute("data-uid");c.usrlvl=a.getAttribute("data-lvl");c.id=a.getAttribute("data-id");c.unixtime=1*a.getAttribute("data-time");
c.isRedirected=!!a.getAttribute("data-redirected");return c}},getOldestID:function(){var a=document.querySelectorAll("#messages > .msg");if(!a.length)return null;for(var c=Infinity,b=0;b<a.length;b++){var e=messages.getData(a[b]);e&&e.id&&1*e.id&&(c=Math.min(c,1*e.id))}return Math.max(c,0)},insertAtHead:function(a,c){var b=document.getElementById("msgHead");config.bs&&!c||!config.bs&&c?b.parentElement.insertBefore(a,b):b.parentElement.insertBefore(a,b.nextSibling)},trimTail:function(a){var c=messages.getAll(),
b=function(a){c[a]&&(unreadMessages[0]===c[a]&&unreadMessages.shift(),c[a].parentElement.removeChild(c[a]))};if(config.bs){a=c.length-a;for(var e=0;e<a;e++)b(e)}else for(e=c.length-1;e>=a;e--)b(e)},setBookmark:function(){cbx.$markobj||(cbx.$markobj=document.createElement("div"),cbx.$markobj.className="notMsg Marker");messages.insertAtHead(cbx.$markobj);messages.numSinceBookmark=0},numSinceBookmark:0},unreadMessages=[],droppedMessages=0,insertMessage=function(a){var c=function(a){cbx.debug.log(a,"MSG")};
a.id>cbx.lp&&1*a.id&&!isPaused&&(cbx.lp=a.id);var b=function(a){var b=[];if(a.isTemp||a.isSticky)return b.push('<div align="center">'+a.msghtml+"</div>"),b.join("");config.av&&(a.imgurl?b.push('<img src="'+a.imgurl+'" class="pic">'):b.push('<span class="pic Empty"></span>'));config.sf&&b.push(a.flaghtml);a.isPrivate&&b.push('<div class="status" title="'+lang[15]+'"></div>');a.isRedirected&&b.push('<div class="status" title="'+lang[26]+'"></div>');a.isPinned&&b.push('<div class="status" title="Pinned"></div>');
1<config.dt&&b.push('<div class="dtxt" id="t'+a.unixtime+'" '+(config.rt?'dir="ltr"':"")+">"+a.datestr+"</div>");b.push("<div");1==config.dt&&b.push(' title="'+a.datestr+'"');b.push(' class="nme"');config.rt&&b.push(' dir="ltr"');b.push(">"+a.namehtml+"</div>");config.ae&&a.exturl&&b.push('<a href="'+a.exturl+'" rel="noreferrer" target="_blank" class="nmeurl"></a>');b.push('<div class="body">'+a.msghtml+"</div>");return b.join("")},e=!1,d=messages.getById(a.id);d&&(e=!0,c("Got update for message "+
a.id));a.localID&&(d=messages.getById("L"+a.localID))&&(e=!0,c("Got update for local message "+a.localID));var f=cbx.gsUser.get("ignores")||[];if(f.indexOf&&(-1<f.indexOf(a.uid)||-1<f.indexOf(a.namehtml)))return c("User in ignore list; ignoring"),!1;if(a.msghtml||e){f=["msg"];a.isSticky&&f.push("Sticky");a.isTemp&&f.push("Temp");a.isPrivate&&f.push("Private");a.isServer&&f.push("Server");a.isRedirected&&f.push("Redirected");a.isPinned&&f.push("Pinned");a.isLocal&&f.push("Sending");switch(a.usrlvl){case "2":f.push("Reg");
break;case "3":f.push("Mod");break;case "4":f.push("Adm");break;case "5":f.push("Bot")}d||(d=document.createElement("div"));e&&(a.isUpdate=!0);if(!e&&isPaused)droppedMessages++,c("Paused; dropped");else{e||messages.numSinceBookmark++;scrollFollow||e||(f.push("Unread"),unreadMessages.push(d));if(a.msghtml||!e)d.innerHTML=b(a);d.className=f.join(" ");d.setAttribute("data-id",a.id);d.setAttribute("data-time",a.unixtime);d.setAttribute("data-uid",a.uid||0);d.setAttribute("data-lvl",a.usrlvl||0);a.isRedirected&&
d.setAttribute("data-redirected","true");if(e)c("Updated message "+a.id),a.isPinned&&messages.insertAtHead(d,!0);else{if(b=document.getElementById("msgWelcome"))b.style.display="none";a.isPinned?messages.insertAtHead(d,!0):messages.insertAtHead(d);c("Inserted message "+a.id);cbx.autoScroll(!1)}return d}}else c("Empty message; ignoring")},relTime=function(a){var c=cbx.unixTime(),b=lang[16],e=[2592E3,604800,86400,3600,60,1];c=a=c-a;0>c&&(c=0);60>c&&(c=5*Math.ceil(c/5));for(var d=0;6>d;d++){var f=0;
if(1<c/e[d]){c/=e[d];f=10-2*d;break}}c=Math.round(c);return{str:5>a?"&nbsp;":lang[24].replace("%d",c).replace("%s",b[1==c?f:f+1]),secs:a}},updTmsTmr=null;
cbx.upd_tms=function(){if(3!=config.dt)return!0;null!==updTmsTmr&&window.clearTimeout(updTmsTmr);for(var a=messages.getAll(),c=60,b=0;b<a.length;b++){var e=messages.getData(a[b]);if(e.unixtime){var d=a[b].querySelector(".dtxt");d&&(e=relTime(e.unixtime),c=Math.min(e.secs,c),d.title||(d.title=d.innerHTML),d.innerHTML=e.str)}}updTmsTmr=window.setTimeout(cbx.upd_tms,1E3*Math.max(7,c))};
cbx.colorPicker=function(){var a=null,c="262626 c00000 e16900 e1c700 669f00 00a198 004c92 5f03bb 9c026e 444444 DE1A10 FF870F FFE500 84BD00 00BFB6 006AB0 7D21D9 BA208C 808080 ff564c ffc34b ffff3c c0f93c 3cfbf2 3ca6ec b95dff f65cc8".split(" "),b=function(){if(a)return a;a=overlay.create("Colour picker","colorPicker");for(var b=['<table border="0" cellpadding="0" cellspacing="0" width="100%" style="cursor:pointer">'],f=0,g=1;f<c.length;f++)0===f%9&&(b[g++]="<tr>"),b[g++]='<td style="height: 2em; width: '+
100/9+"%; background-color: #"+c[f]+';">&nbsp;</td>',8===f%9&&(b[g++]="</tr>");b[g++]="</table>";a.body.innerHTML=b.join("");a.body.onclick=function(a){a.target&&"TD"==a.target.tagName&&(cbx.setInputMode("^#"+c[9*a.target.parentElement.rowIndex+a.target.cellIndex]),e())};return a},e=function(){var a=b();a&&overlay.switchTo(a.isVisible?null:a)};return{toggle:e}}();
var insertAtCaret=function(a,c){var b=document,e=b.forms[0].pst,d;e.value==lang[3]&&(e.value="");if(b.selection){var f=b.selection.createRange();null!=f.text&&(f.text="\u0001");var g=d=e.value.indexOf("\u0001");-1==g&&(g=d=e.value.length);f.moveStart("character",-1);f.text=""}else"null"!=e.selectionStart&&(d=e.selectionStart,g=e.selectionEnd);var h=" "==e.value.charAt(g)?!0:!1;a=(c||0==d||" "==e.value.charAt(d-1)?"":" ")+a;a+=c||h?"":" ";e.value=e.value.substring(0,d)+a+e.value.substring(g);a=d+a.length+
(h?1:0);b.selection?(f.moveEnd("character",-e.value.length),f.moveEnd("character",a),f.moveStart("character",a),f.select()):"null"!=e.selectionStart&&(e.selectionStart=a,e.selectionEnd=a);e.focus()};cbx.msgModeStr="";
cbx.setInputMode=function(a){var c=cbx.$frm;"undefined"===typeof a&&(a="",c.pst.value.substring(0,cbx.msgModeStr.length)==cbx.msgModeStr&&(a=cbx.msgModeStr),c.pst.value="");if(c.pst.value.substring(0,a.length)!==a){var b=c.pst.value.substring(cbx.msgModeStr.length+(cbx.msgModeStr?1:0));c.pst.value=(a?a+" ":"")+b;cbx.msgModeStr=a}c.pst.focus();a=c.pst;"number"==typeof a.selectionStart?a.selectionStart=a.selectionEnd=a.value.length:"undefined"!=typeof a.createTextRange&&(a.focus(),a=a.createTextRange(),
a.collapse(!1),a.select())};
var makeButton=function(){return function(a,c,b,e,d,f){var g=null,h="",k="",l={disable:function(){h="disabled";g.className=k+" Disabled";return l},enable:function(){h="interactive";g.className=k+" Interactive";g.style.display="";return l},hide:function(){h="hidden";g.style.display="none";return l},text:function(a){m.textContent=a;return l},onclick:function(a){g.onclick=function(b){if("interactive"!=h)return!1;if("function"===typeof a)return a(l,b),b.stopPropagation(),b.preventDefault=!0,!1};return l},
icon:function(a){n.className="ico "+a;return l},tip:function(a){g.alt=a||"";Tooltip(g,a,g);return l},element:function(){return g},addClass:function(a){k+=" "+a;g.className=k;return l},classToggle:function(a,b){classToggle(g,a,b);return l},ref:f};d&&(g=document.getElementById(d));g||(d&&cbx.debug.log("Elem "+d+" not found; creating.","BTN"),g=document.createElement("button"),g.type="button",d&&(g.id=d));g.innerHTML="";k=g.className;h="disabled";var n=document.createElement("i");l.icon(a);var m=document.createElement("span");
l.text(c);g.appendChild(n);g.appendChild(m);l.tip(b);l.onclick(e);return l}}(),msgTools=function(){var a=null,c=null,b=null,e=function(){a.className="msgtools";b.icon("EllipsisV");b.tip("");c=a;b=a=null;document.body.onmousedown=null};return{create:function(d){var f=document.createElement("div");f.className="msgtools";var g=document.createElement("div");g.className="btntray";for(var h=d.length-1;0<=h;h--){var k=makeButton(d[h].cN,"",d[h].text,d[h].call).enable();g.appendChild(k.element());d[h].btn=
k}f.appendChild(g);f.appendChild(makeButton("EllipsisV","","",function(h){scrollFollow=!1;c=null;null!==a&&e();if(f!==c){f.className="msgtools Open";a=f;b=h;for(var k=d.length-1;0<=k;k--)d[k].onfirstshow&&(d[k].onfirstshow(d[k].btn),d[k].onfirstshow=null);h=h.element().getBoundingClientRect();g.style.right=h.right-h.left+"px";document.body.onmousedown=function(a){a=a.target;do if(a===g||a===f)return;while(a=a.parentElement);e()}}}).enable().element());return f},close:e}}(),imgOverlay=overlay.create("Image",
"Image"),showFullImage=function(a){a&&(a=a.replace(/cbox.im\/i\/([a-z0-9]+?)\.(.+?)\.([a-z0-9]{1,5})/i,"cbox.im/i/$1.$3"),overlay.switchTo(imgOverlay),imgOverlay.body.innerHTML='<img src="'+a+'">',imgOverlay.body.onclick=function(){overlay.switchTo()})},lnkd=[],msgToolsUpdate=function(){var a=!1;cbx.debug.log("Tool update","MTU");var c=cbx.gsUser.get("lvl"),b=cbx.gsUser.get("lpid"),e=cbx.gsUser.get("uid");2<c&&(a=!0);a&&config.modtid&&config.tid!=config.modtid?cbx.modBtn.enable():cbx.modBtn.hide();
for(var d=messages.getAll(),f=0;f<d.length;f++){var g=d[f],h=[];(function(d,f){var g=d.id;Emotes.enqueueAll(f);var k=f.querySelector("img.pic");k&&!k.onclick&&(k.onclick=function(){showFullImage(k.src)});config.pm&&0<d.uid&&e&&d.uid!==e&&(a||2<d.usrlvl)&&h.push({cN:"Envelope",text:lang[15],call:function(){cbx.setInputMode("//pm "+d.uid);msgTools.close();return!1}});(a||config.ld&&!d.isRedirected&&g==b&&g==cbx.lp&&1<c)&&0<g&&h.push({cN:"Trash",text:lang[17],call:function(){cbx.del(g);f.className+=
" Deleting";msgTools.close();return!1}});a&&0<g&&d.uid!=e&&c>d.usrlvl&&4>d.usrlvl&&h.push({cN:"Ban",text:lang[18],call:function(a){cbx.ban(g,a.element());msgTools.close();return!1},onfirstshow:function(a){cbx.xhr("getip",{n:cbx.$frm.nme.value,k:cbx.$frm.key.value,i:d.id},null,function(b,c){if(!b||c)return!1;a.tip(lang[18]+" (IP: "+b+")")})}});config.modtid&&a&&d.usrlvl<c&&1<d.usrlvl&&h.push({cN:"VoiceOn",text:"Toggle voice",call:function(){msgTools.close();var a=cbx.$frm;cbx.xhr("delban",{n:a.nme.value,
k:a.key.value,voicetoggle:g},null,function(a,b){b?statusBar.warn(b):statusBar.set(a)});return!1}});config.modtid&&a&&d.isRedirected&&h.push({cN:"Accept",text:"Accept and publish",call:function(){msgTools.close();var a=cbx.$frm;cbx.xhr("delban",{n:a.nme.value,k:a.key.value,repost:g},null,function(a,b){b?statusBar.warn(b):cbx.del_proc(g,g)});return!1}});lnkd[g]&&lnkd[g].parentElement&&(lnkd[g].parentElement.removeChild(lnkd[g]),delete lnkd[g]);if(h.length){var l=msgTools.create(h);f.insertBefore(l,
f.firstChild);lnkd[g]=l}})(messages.getData(g),g)}Emotes.load();if(config.nq&&document.getElementsByClassName)for(d=document.getElementsByClassName("nme"),f=0;f<d.length;f++)d[f].parentElement&&"A"!==d[f].parentElement.tagName&&d[f].textContent&&(d[f].onclick=function(a){return function(b){if(a&&a.textContent){b=a.textContent;var c=a.parentElement&&1*a.parentElement.getAttribute("data-uid");c?insertAtCaret("<@"+c+"|"+b+">"):insertAtCaret("<@"+b+">")}}}(d[f]));d=document.getElementById("messages").getElementsByClassName("bbImg");
for(f=0;f<d.length;f++)d[f].style.cursor="zoom-in",d[f].onclick=function(a){showFullImage(a.target.src)};cbx.autoScroll(!1)};
cbx.ban=function(a,c){var b=cbx.$frm,e=makeCtxmenu(),d=function(c){e.hide();c.ref&&cbx.xhr("delban",{n:b.nme.value,k:b.key.value,ban:a,dur:c.ref},null,function(a,b){b?statusBar.warn(b):a&&(a=a.split("\t"),a[1]&&statusBar.set(a[1]))})};e.add(makeButton("Clock","Ban for a week","",d,"",604800).enable().element());e.add(makeButton("Clock","Ban for a day","",d,"",86400).enable().element());e.add(makeButton("Clock","Ban for an hour","",d,"",3600).enable().element());e.add(makeButton("Clock","Ban for 5 minutes",
"",d,"",300).enable().element());e.add(makeButton("Cancel","Cancel","",d,"",0).enable().element());e.show(c)};cbx.del=function(a){var c=cbx.$frm;cbx.xhr("delban",{n:c.nme.value,k:c.key.value,del:a},null,function(a,c){c?statusBar.warn(c):a&&cbx.del_proc(a,a)})};
cbx.del_proc=function(a,c){isNaN(c)&&(c=a);if(isNaN(a))return!1;var b=Math.min(a,c);a=Math.max(c,a);c=messages.getAll();for(var e=0,d=0;d<c.length;d++){var f=c[d],g=messages.getData(f);if(!g.isDeleted&&g.id>=1*b&&g.id<=1*a)for(classToggle(f,"Deleted",!0),e++,g=0;g<unreadMessages.length;g++)if(unreadMessages[g]==f){unreadMessages.splice(g,1);break}}window.setTimeout(function(){for(var a=document.querySelectorAll("#messages > .msg.Deleted"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},500);
return e};cbx.proc_rpc_del=function(a){a=a.split(",");for(var c,b,e=0;e<a.length;e++)0>a[e].indexOf("_")?(c=parseInt(a[e],10),isNaN(c)||cbx.del_proc(c,c)):(b=a[e].split("_"),c=parseInt(b[0],10),b=parseInt(b[1],10),isNaN(c)||isNaN(b)||cbx.del_proc(c,b))};
var updateFavicon=function(){var a=document.createElement("canvas"),c=document.createElement("link");if(!a.getContext)return function(){};var b=a.getContext("2d");a.height=a.width=48;var e=function(){for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b].getAttribute("rel");if(c&&c.match(/icon/))return c=a[b].href,a[b].parentElement.removeChild(a[b]),c}},d=!1,f=new Image;f.onload=function(){d=!0};f.crossOrigin="anonymous";f.src=e();return function(g){if(!isNaN(g)){b.font='bold 32px "Helvetica", "Tahoma", sans-serif';
b.clearRect(0,0,a.width,a.height);d&&(b.save(),b.scale(1/(f.width/a.width),1/(f.height/a.height)),b.drawImage(f,0,0),b.restore());e();if(0<g){g=99>1*g?1*g:"99";var h=b.measureText(g);b.fillStyle="rgba(255, 255, 255, 0.8)";b.fillRect(a.width-h.width-2,a.height-32-2,h.width+2,34);b.fillStyle="#dd2211";b.textBaseline="top";b.fillText(g,a.width-h.width,a.height-32)}c.rel="icon";c.type="image/png";c.sizes="48x48";c.href=a.toDataURL("image/png");c.parentNode!==document.head&&document.head.appendChild(c)}}}(),
titleT=null,stitle=document.title;function titleflash(){if(cbx.isTopLevel&&!windowIsFocused){updateFavicon(messages.numSinceBookmark);var a="New message! - "+stitle,c=!1;document.title=a;titleT=window.setTimeout(function(){document.title=c?a:stitle;c=!c},2E3)}}
var loadSWF=function(a,c){function b(a,b){return'<param name="'+a+'" value="'+b+'">'}window.document.getElementsByTagName("html");var e={name:a,id:a,src:c,quality:"high",allowScriptAccess:"always",bgcolor:"#ffffff",pluginspage:"http://www.macromedia.com/go/getflashplayer",title:"FL",type:"application/x-shockwave-flash",hasPriority:"true",width:1,height:1};var d={position:"absolute",width:"8px",height:"8px",bottom:"0px",left:"-10px",overflow:"hidden","z-index":"10000"};var f="",g;for(g in e)f+=g+'="'+
e[g]+'" ';var h="";for(g in d)h+=g+": "+d[g]+"; ";c=['<object style="'+h+'" id="'+a+'" data="'+c+'" type="'+e.type+'" title="'+e.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',b("movie",c),b("AllowScriptAccess",e.allowScriptAccess),b("quality",e.quality),b("bgcolor",e.bgcolor),b("hasPriority",e.hasPriority),"<embed "+f+">","</object>"].join("");e=document.getElementById("flash_"+a)||document.createElement("div");
e.id="flash_"+a;document.body.appendChild(e);e.innerHTML=c;return document[a]},audioPlay=function(a){},initAudio=function(a){if(config.sn){var c={volAll:20,volTag:100};config.sv&&(c.volAll=c.volTag=0);var b={0:"Mute",20:"Low",100:"High"},e=cbx.gsUser.get("audiovols");if(e)for(var d in c)"undefined"===typeof e[d]||0!=e[d]&&20!=e[d]&&100!=e[d]||(c[d]=1*e[d]);var f=function(){var a=0,b;for(b in c)a=Math.max(a,c[b]);return a};e=function(a){var d=a.ref;d=100==c[d]?c[d]=20:20==c[d]?c[d]=0:c[d]=100;a.icon("Volume"+
b[d]);cbx.audio.play(d);h.icon("Volume"+b[f()]);cbx.gsUser.set("audiovols",c)};var g=makeCtxmenu();g.add(makeButton("Volume"+b[c.volAll],"On new messages","",e,"","volAll").enable().element());g.add(makeButton("Volume"+b[c.volTag],"On @tagged messages","",e,"","volTag").enable().element());var h=makeButton("VolumeMute","","Notification options",function(a){g.show(a.element())},"btnVolume");h.icon("Volume"+b[f()]);h.enable();cbx.audio.setup(a);audioPlay=function(a){cbx.audio.play(c[a]||0)}}};
cbx.audio=function(){var a=function(a){cbx.debug.log(a,"AUDIO")};return{play:function(){a("Play called but not configured.")},setup:function(c){a("Setup called with "+c);var b=null,e=function(){window.soundManager={_externalInterfaceOK:function(d){a("SWF: ExternalInterface online! Version: "+d);window.setTimeout(function(){b._createSound("cbxsnd",1,!1)},100);window.setTimeout(function(){a("Flash: loading "+c+".mp3");b._load("cbxsnd",c+".mp3",!0,!1,!1)},500)},sounds:{cbxsnd:{_onload:function(c){c?
(a("SWF: Loaded - configuring for play."),cbx.audio.play=function(c){a("Flash play called at volume "+c);b._setVolume("cbxsnd",c);b._start("cbxsnd",1,0,!1)}):a("SWF: Load failed - not switching play")},_onfinish:function(){a("SWF: Got onfinish")}}}};cbx.audio.play=function(b){a("Play waiting on flash")};a("Attempting to load Flash object...");var b=loadSWF("SMswf",config.smuri)};if(!("Audio"in window))return a("No Audio object found - fast fallback."),e(),!1;var d=null;b=new Audio;var f=function(c){window.clearTimeout(h);
b?(a("Ready via '"+c.type+"'. Duration "+b.duration+"."),cbx.audio.play=function(c){b?d?a("Play ongoing."):0!=c&&(d=window.setTimeout(function(){a("Play timeout. Falling back.");e()},5E3),cbx.audio.playStart=(new Date).getTime(),b.volume=c/100,b.play()):a("Play fired by object destroyed")},b.removeEventListener("canplay",f,!1),b.removeEventListener("canplaythrough",f,!1)):a("Ready fired but object destroyed.")},g=".ogg";b.canPlayType&&b.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")||
(g=".mp3");a("Audio object created; chose "+g);var h=window.setTimeout(function(){a("Load timeout. Falling back.");b=null;e()},5E3);b.addEventListener("canplay",f,!1);b.addEventListener("canplaythrough",f,!1);b.addEventListener("error",function(c){a("Got error. Falling back");window.clearTimeout(h);d&&(window.clearTimeout(d),d=null);b=null;e()},!1);b.addEventListener("timeupdate",function(a){b&&b.currentTime&&null!==d&&(window.clearTimeout(d),d=null)},!1);a("Setting source: "+c+g);b.setAttribute("src",
c+g)}}}();
cbx.repl=function(){try{var a=window.localStorage}catch(p){}var c="repl:",b=0,e="xxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)}),d=function(a){if(a!==b&&(cbx.debug.log(b+"->"+a,"RP"),b=a,m.state=b,m.onstatechange))m.onstatechange(b)},f=0,g=function(){var b=(new Date).getTime(),g="",h=null;try{g=""+a.getItem(c+":master"),h=JSON.parse(g)}catch(q){}g=function(){try{a.setItem(c+":master",JSON.stringify({id:e,tme:b}))}catch(q){}};m.masterID=null;h&&
h.id?h.tme<b-3*(b-f)?(g(),d(3)):h.id!==e?(m.masterID=h.id,n(null),d(4)):(g(),d(2)):(d(1),g());f=b},h=0,k=null,l=!0,n=function(d){if(4===b){var e="",f={};if(d&&d.key){if(d.key!==c+":buffer")return;try{e=d.newValue,f=JSON.parse(e)||{}}catch(q){return}}else try{e=""+a.getItem(c+":buffer"),f=JSON.parse(e)||{}}catch(q){return}if(f&&f.pos!==k)if(k=f.pos,l)l=!1;else if("undefined"!==typeof f.msg&&m.onmessage)m.onmessage(f.msg)}},m={start:function(d){0<b||"string"!==typeof d||1>d.length||(a?(c+=d,m.clientID=
e,window.setTimeout(g,0),window.setInterval(g,2E3),window.addEventListener?(window.addEventListener("storage",n),window.addEventListener("unload",m.stop)):(window.document.attachEvent("onstorage",n),window.attachEvent("onunload",m.stop))):cbx.debug.log("No localStorage object - cookie policy?","RP"))},stop:function(){if(4!==b){try{a.removeItem(c+":master"),a.removeItem(c+":buffer")}catch(p){}d(0)}},onmessage:function(a){},sendmessage:function(d){if(4!==b){h++;try{a.setItem(c+":buffer",JSON.stringify({msg:d,
pos:e+h}))}catch(r){}}},pump:n,state:null,onstatechange:null,clientID:null,masterID:null};return m}();
cbx.FP=function(){var a=2,c=2;try{a=1*!!window.indexedDB}catch(d){}try{c=1*!!window.openDatabase}catch(d){}var b=function(){var b=navigator;return[b.userAgent,b.language||b.userLanguage||b.browserLanguage||b.systemLanguage,b.languages&&b.languages.join(","),screen.colorDepth,screen.width,screen.height,screen.availHeight,screen.availWidth,(new Date).getTimezoneOffset(),a,c,b.cpuClass,b.platform,b.doNotTrack,b.maxTouchPoints||b.msMaxTouchPoints,e()].join("|")},e=function(){try{var a=document.createElement("canvas");
a.width=400;a.height=200;a.style.display="inline";var b=a.getContext("2d");b.textBaseline="alphabetic";b.fillStyle="#f60";b.fillRect(125,1,62,20);b.fillStyle="#069";b.font="23pt Arial";b.fillText("DWM fjordbank vext zz4, \ud83d\ude03",2,15);b.fillStyle="rgba(102, 204, 0, 0.7)";b.font="23pt Arial";b.fillText("DWM fjordbank vext zz4, \ud83d\ude03",4,45);b.globalCompositeOperation="multiply";b.fillStyle="rgb(255,0,255)";b.beginPath();b.arc(50,50,50,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle=
"rgb(0,255,255)";b.beginPath();b.arc(100,50,50,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="rgb(255,255,0)";b.beginPath();b.arc(75,100,50,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="rgb(255,0,255)";b.arc(75,75,75,0,2*Math.PI,!0);b.arc(75,75,25,0,2*Math.PI,!0);b.fill("evenodd");return a.toDataURL()}catch(g){return""}};return{string:function(a){window.setTimeout(function(){a(b())},0)},hash:function(a){window.setTimeout(function(){var c=b(),d=0,e;c+="";var k=0;for(e=c.length;k<e;k++){var l=
c.charCodeAt(k);d=(d<<5)-d+l;d|=0}a(d)},0)}}}();
cbx.addTypingHandler=function(){return function(a,c){var b="IDLE",e=null,d=null,f=0,g=null,h=function(a){b!==a&&(b=a,null!==d&&(window.clearTimeout(d),d=null),a=(new Date).getTime()-f,d=window.setTimeout(function(){e!==b&&(c("TYPING"==b?!0:!1),e=b);f=(new Date).getTime()},"TYPING"==b?2500:1E3>a?1E3-a:0))},k=function(){null!==g&&(window.clearTimeout(g),g=null);2>a.value.length?h("IDLE"):(h("TYPING"),g=window.setTimeout(function(){h("IDLE")},1500))};a.addEventListener?a.addEventListener("keyup",k,!1):
a.attachEvent&&a.attachEvent("onkeyup",k)}}();
var profileBtn=null,profileBtnSetup=function(){var a=overlay.create(lang[30],"Profile");a.body=document.getElementById("pgProfile");a.body.onsubmit=function(){overlay.switchTo();return!1};var c=makeButton("SignOut",lang[29],"",function(a){cbx.getUserStatus(!0,!1);overlay.switchTo()},"btnLogout").hide(),b=makeButton("Cancel","Remove picture","",function(a){cbx.$frm.pic.value="";e();d()},"btnDelAvatar").hide(),e=function(){var a=document.getElementById("imgContainer");a.innerHTML="";if(a&&cbx.$frm.pic&&
cbx.$frm.pic.value){var c=document.createElement("img");c.src=cbx.$frm.pic.value;a.appendChild(c);b.enable();return!0}a.innerHTML='<i class="ico Camera" style="font-size: 8em;">';return!1},d=function(){cbx.xhr("profile",{},{"do":"update",n:cbx.$frm.nme&&cbx.$frm.nme.value,k:cbx.$frm.key&&cbx.$frm.key.value,url:cbx.$frm.eml&&cbx.$frm.eml.value,pic:cbx.$frm.pic&&cbx.$frm.pic.value},function(a,b){})},f=function(){overlay.switchTo(a);c.hide();1<cbx.gsUser.get("lvl")&&c.enable();var f=document.getElementById("inpProfileURL");
f&&cbx.$frm.eml&&(f.value=cbx.$frm.eml.value,f.onchange=function(){cbx.$frm.eml.value=f.value;cbx.gsUser.set("eml",f.value);d()});if(config.av){e();var h=makeButton("Upload","Change picture","",null,"btnAvatar");window.UploaderReady=function(a){a=a({authKey:config.img_key,authUser:config.img_usr,authApp:"cbox",maxFileSize:1E6,onevent:function(a,c){cbx.debug.log("Event "+a+": "+c,"UPLOAD");"done"==a&&(cbx.$frm.pic.value="https://"+c,cbx.gsUser.set("pic","https://"+c),d(),e(),h.enable(),b.enable(),
statusBar.hide());"error"==a&&statusBar.warn(c);"uploading"==a&&(h.disable(),b.disable(),statusBar.set("Uploading..."));"progress"==a&&statusBar.set("Uploading... "+10*Math.ceil(100*c/10)+"%")}});h.enable().element().appendChild(a)};(function(a,b,c){var d=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),a.id=c,a.src="https://cbox.im/imgs/uploader2.js?115",d.parentNode.insertBefore(a,d))})(document,"script","cbox-uploader")}};profileBtn=makeButton("User","",lang[30],function(){config.uo||
f()},"btnUser");profileBtn.enable()},authBtnExtern=null;cbx.getUserStatus=null;
var authBtnSetup=function(){var a=overlay.create(lang[31],"Auth"),c=function(c,d,e){k();overlay.switchTo(a);var f=a.body,g=document.getElementById("authForm");f.innerHTML="";f.appendChild(g);g.getElementsByTagName("INPUT")&&g.getElementsByTagName("INPUT")[0].focus();f=["Show"];f.push("login"==c?"Login":"Reg");makeButton("SignIn","login"==c?lang[27]:lang[28],"",function(a){g.onsubmit()},"authSubmit").enable();-1<d.indexOf("pw")&&f.push("WithPW");-1<d.indexOf("fb")&&f.push("WithFB");g.className=f.join(" ");
var h="",l="";-1<d.indexOf("fb")&&fbLoginSetup("btnLoginFB",function(a){h="fb";l=a;g.onsubmit()});var m=cbx.$frm.nme.value,n=cbx.$frm.key.value;document.getElementById("authMsg").textContent=e||"";g.onsubmit=function(){for(var a={n:m,k:n,pword:g.pword.value,pword2:g.pword2.value,auth_prov:h,auth_id:l,"do":c},d=0;d<g.elements.length;d++)g.elements[d].value="";cbx.xhr("profile",{json:1},a,function(a,c){c?statusBar.warn(c):(a=JSON.parse(a),a.error?statusBar.warn(a.error):"LOGGED_IN"!=a.state?(overlay.switchTo(),
statusBar.warn("Unknown error. Please try again.")):(a.udata&&cbx.updateUser(a.udata),overlay.switchTo(),b()))});return!1}},b=function(){profileBtn.text(h.value);h.style.display="none";g.hide();cbx.autoScroll(!1)},e=function(a,d){if(h&&h.value.length){var f=h.value,k={LOGGED_IN:function(a,c){b()},LOGGED_OUT:function(){profileBtn.text("");h.style.display="";g.enable();cbx.autoScroll(!1);cbx.updateUser({key:"",lvl:1})},NAME_COLLISION:function(a,b){if(d)c("login",a,b);else g.onclick(function(){f!==h.value?
e(!1,!0):c("login",a,b)})},CAN_REGISTER:function(a,b){if(d)c("register",a,b);else g.onclick(function(){f!==h.value?e(!1,!0):c("register",a,b)})},CANNOT_REGISTER:function(a){g.disable();d&&statusBar.warn("You must log in, but cannot register this name. Please contact the administrator.")}},l=cbx.$frm;l={n:l.nme.value,k:l.key.value,"do":"query"};a&&(l["do"]="logout");g.disable();cbx.xhr("profile",{json:1},l,function(a,b){g.enable();b?cbx.debug.log(b,"AUTH"):(a=JSON.parse(a),cbx.debug.log(a.state,"AUTH"),
k[a.state]&&(a.udata&&a.udata.lvl&&cbx.updateUser({lvl:a.udata.lvl,uid:a.udata.uid}),k[a.state](a.auth_methods,a.message.replace(/%s/,cbx.$frm.nme.value),a.udata)))})}};cbx.getUserStatus=e;var d=null,f=cbx.$frm.nme;var g=makeButton("SignIn","",lang[31],function(){e(!1,!0)},"btnProfile");var h=f;h.value&&cbx.$frm.key.value&&1<cbx.gsUser.get("lvl")&&b();h.value&&window.setTimeout(function(){e(!1,!1)},400);var k=function(){null!==d&&(window.clearTimeout(d),d=null)};h.onchange=function(){k();""==h.value?
g.disable():d=window.setTimeout(function(){e(!1,!1)},500)};h.onkeydown=function(a){if(a&&9==a.keyCode)return cbx.$frm.pst.focus(),a.preventDefault&&a.preventDefault(),!1;if(a&&13==a.keyCode)return e(!1,!0),a.preventDefault&&a.preventDefault(),!1};authBtnExtern=function(){e(!1,!0)};h.onkeyup=function(a){k();""==h.value?g.disable():d=window.setTimeout(function(){e(!1,!1)},500)}},fbLoginSetup=function(){var a=function(a){cbx.debug.log(a,"FBBTN")},c=null,b=null,e=!1,d=!1,f=function(d){var g=window.FB;
a("Got login status: "+d.status);document.getElementById(c).className="btnAuthFB Interactive";if("connected"!==d.status)document.getElementById(c).onclick=function(){e=!0;a("Doing login...");g.login(f,{scope:"public_profile,email",return_scopes:!0})};else{var k=function(){document.getElementById(c).className="btnAuthFB Loading";document.getElementById(c).onclick=function(){};a("Got access token");b(d.authResponse.accessToken)};document.getElementById(c).onclick=function(){e=!0;k()};e&&k()}};return function(g,
h){var k=window.FB;c=g;b=h;d?(e=!1,document.getElementById(c).onclick=null,document.getElementById(c).className="btnAuthFB Loading",k.getLoginStatus(f)):(a("Loading FB lib..."),document.getElementById(c).className="btnAuthFB Loading",function(a,b,c){var d=a.getElementsByTagName(b)[0];a.getElementById(c)||(a=a.createElement(b),a.id=c,a.src="//connect.facebook.net/en_US/sdk.js",d.parentNode.insertBefore(a,d))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){k=window.FB;a("Got FB init; awaiting login status");
d=!0;k.init({appId:"701215030022299",cookie:!1,xfbml:!1,version:"v2.2"});k.getLoginStatus(f)})}}(),Blank=function(){try{var a=window.localStorage}catch(d){}var c="blank:",b=function(){window.location="about:blank";throw Error("Blanked");},e=function(b){try{if(b){var d=JSON.stringify(b);a.setItem(c,d)}else a.removeItem(c)}catch(g){}};return{init:function(d){c+=d;d={};try{var f=a.getItem(c);f&&(d=JSON.parse(f))}catch(g){}1*d.expire>(new Date).getTime()&&b();e(null)},set:function(a){0<1*a&&(a=Math.min(a,
604800),e({expire:(new Date).getTime()+1E3*a}));b()}}}(),userViewMon=function(){var a={state:"",onstatechange:null},c=null,b=null,e=function(d){d!==b&&(b=d,null!==c&&(window.clearTimeout(c),c=null),c=window.setTimeout(function(){if(b!=a.state&&(a.state=b,"function"===typeof a.onstatechange))a.onstatechange(a.state,a.props)},"ACTIVE"==b?800:2400))},d={},f=function(b,c){if(d[b]!==c){d[b]=c;a.props=d;b="IDLE";d.dimensioned&&d.hidden&&(b="BACKGROUND");if(d.hover||d.focus)b="ACTIVE";e(b)}},g=function(a){a.target===
document.documentElement&&f("hover","mouseover"==a.type||"mouseenter"==a.type)},h=function(){var a=document.hasFocus();f("focus",a)},k=function(){f("hidden","hidden"==document.visibilityState)},l=function(){var a=document.documentElement.clientHeight;f("dimensioned",!(!document.documentElement.clientWidth||!a))},n=function(a,b,c){a.addEventListener?a.addEventListener(b,c,{passive:!0,capture:!1}):a.attachEvent&&a.attachEvent("on"+b,c)};a.init=function(b){n(window,"resize",l);n(window,"resize",l);n(document,
"visibilitychange",k);var c=document.documentElement;c&&(n(c,"mouseenter",g),n(c,"mouseleave",g));n(window,"focus",h);n(window,"blur",h);k();h();l();f("istop",window===window.parent);a.onstatechange=b};return a}();window.do_refresh=do_refresh;window.do_post=do_post;window.CBXINIT?window.CBXINIT(init):window.CBXINIT=init;
